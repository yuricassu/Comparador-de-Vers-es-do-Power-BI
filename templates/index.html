<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Comparador de Modelos Power BI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <!-- Importando Font Awesome para usar √≠cones -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">

    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
<div class="container">
    <h1>üìä Comparador de Vers√µes de Modelos Power BI</h1>

    <form id="uploadForm" method="POST" enctype="multipart/form-data">
        <div class="upload-section">
            <div class="file-upload-container" id="dropCurrent">
                <label class="custom-file-upload">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    Escolher PBIT Atual
                    <input type="file" id="currentFile" name="pbit_file" required>
                </label>
                <span class="file-name" id="currentFileName">Nenhum arquivo selecionado</span>
                <span class="upload-feedback" id="currentFileFeedback"></span>
            </div>

            <div class="file-upload-container" id="dropPrevious">
                <label class="custom-file-upload">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    Escolher PBIT Anterior
                    <input type="file" id="previousFile" name="previous_pbit_file">
                </label>
                <span class="file-name" id="previousFileName">Nenhum arquivo selecionado</span>
                <span class="upload-feedback" id="previousFileFeedback"></span>
            </div>

            <button type="submit" class="analyze-btn">
                <i class="fas fa-search"></i> üìå Analisar
            </button>
        </div>

        <div class="progress-bar" id="progressBar" style="display:none;">
            <div class="progress" id="progress"></div>
        </div>
    </form>

    <div id="analysisComplete" class="checkmark" style="display:none;">‚úî An√°lise Completa!</div>

    {% if summary %}
    <div class="cards">
        <div class="card added">
            <h3>‚úî Adicionados</h3>
            <p>{{ summary['Adicionados'] }}</p>
        </div>
        <div class="card removed">
            <h3>‚úñ Removidos</h3>
            <p>{{ summary['Removidos'] }}</p>
        </div>
        <div class="card modified">
            <h3>‚ö† Modificados</h3>
            <p>{{ summary['Modificados'] }}</p>
        </div>
    </div>
    {% endif %}

    {% if report %}
    <div class="report-section">
        <h2>üîç Relat√≥rio Detalhado</h2>

        <h3>Adicionados</h3>
        <ul>
        {% for item in report['added'] %}
            <li>{{ item }}</li>
        {% else %}
            <li>Nenhum</li>
        {% endfor %}
        </ul>

        <h3>Removidos</h3>
        <ul>
        {% for item in report['removed'] %}
            <li>{{ item }}</li>
        {% else %}
            <li>Nenhum</li>
        {% endfor %}
        </ul>

        <h3>Modificados (Compara√ß√£o Visual)</h3>
        {% if report['modified'] %}
            <div class="comparison-table">
                <div class="table-header">
                    <div>Tipo</div>
                    <div>Tabela</div>
                    <div>Nome</div>
                    <div>Altera√ß√£o</div>
                    <div>Antes</div>
                    <div>Depois</div>
                </div>
                {% for m in report['modified'] %}
                <div class="table-row">
                    <div>{{ m.tipo }}</div>
                    <div>{{ m.tabela }}</div>
                    <div>{{ m.nome }}</div>
                    <div>{{ m.alteracao_tipo }}</div>
                    <div class="old-value" title="{{ m.valor_antigo }}">{{ m.valor_antigo }}</div>
                    <div class="new-value" title="{{ m.valor_novo }}">{{ m.valor_novo }}</div>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p>Nenhum</p>
        {% endif %}
    </div>

    <a class="download" href="{{ url_for('download_pdf') }}">
        <i class="fas fa-file-download"></i> üì• Baixar PDF
    </a>
    {% endif %}
</div>
<script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
